<!DOCTYPE html>
<meta charset="utf-8">
<style>
    .link {
        stroke: #000;
    }
    
    .node {
        stroke: #fff;
    }
    
    body {
        width: 100%;
        height: 100vh;
    }
</style>

<body>
    <script src="//d3js.org/d3.v3.min.js"></script>
    <script>
        var width = 2600,
            height = 1500;

        var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);

        var force = d3.layout.force()
            .size([width, height]);

        d3.csv("ad-interests-simplify.csv", function(error, links) {
            if (error) throw error;

            var nodesByName = {};

            // Create nodes for each unique source and target.
            links.forEach(function(link) {
                link.source = nodeByName(link.source);
                link.target = nodeByName(link.target);
            });

            // Extract the array of nodes from the map by name.
            var nodes = d3.values(nodesByName);

            // Create the link lines.
            var link = svg.selectAll(".link")
                .data(links)
                .enter().append("line")
                .attr("class", "link");

            // Create the node circles.
            var node = svg.selectAll(".node")
                .data(nodes)
                .enter().append("circle")
                .attr("class", "node")
                .attr("r", 10)
                .call(force.drag);
            // values for all forces
            forceProperties = {
                center: {
                    x: 0.5,
                    y: 0.5
                },
                charge: {
                    enabled: true,
                    strength: -30,
                    distanceMin: 1,
                    distanceMax: 2000
                },
                collide: {
                    enabled: true,
                    strength: .7,
                    iterations: 1,
                    radius: 5
                },
                forceX: {
                    enabled: false,
                    strength: .1,
                    x: .5
                },
                forceY: {
                    enabled: false,
                    strength: .1,
                    y: .5
                },
                link: {
                    enabled: true,
                    distance: 30,
                    iterations: 1
                }
            }

            // add forces to the simulation
            function initializeForces() {
                // add forces and associate each with a name
                simulation
                    .force("link", d3.forceLink())
                    .force("charge", d3.forceManyBody())
                    .force("collide", d3.forceCollide())
                    .force("center", d3.forceCenter())
                    .force("forceX", d3.forceX())
                    .force("forceY", d3.forceY());
                // apply properties to each of the forces
                updateForces();
            }

            // apply new force properties
            function updateForces() {
                // get each force by name and update the properties
                simulation.force("center")
                    .x(width * forceProperties.center.x)
                    .y(height * forceProperties.center.y);
                simulation.force("charge")
                    .strength(forceProperties.charge.strength * forceProperties.charge.enabled)
                    .distanceMin(forceProperties.charge.distanceMin)
                    .distanceMax(forceProperties.charge.distanceMax);
                simulation.force("collide")
                    .strength(forceProperties.collide.strength * forceProperties.collide.enabled)
                    .radius(forceProperties.collide.radius)
                    .iterations(forceProperties.collide.iterations);
                simulation.force("forceX")
                    .strength(forceProperties.forceX.strength * forceProperties.forceX.enabled)
                    .x(width * forceProperties.forceX.x);
                simulation.force("forceY")
                    .strength(forceProperties.forceY.strength * forceProperties.forceY.enabled)
                    .y(height * forceProperties.forceY.y);
                simulation.force("link")
                    .id(function(d) {
                        return d.id;
                    })
                    .distance(forceProperties.link.distance)
                    .iterations(forceProperties.link.iterations)
                    .links(forceProperties.link.enabled ? graph.links : []);

                // updates ignored until this is run
                // restarts the simulation (important if simulation has already slowed down)
                simulation.alpha(1).restart();
            }
            // Start the force layout.
            force
                .nodes(nodes)
                .links(links)
                .on("tick", tick)
                .linkDistance(200)
                .charge(-300)
                .start();


            function tick() {
                link.attr("x1", function(d) {
                        return d.source.x;
                    })
                    .attr("y1", function(d) {
                        return d.source.y;
                    })
                    .attr("x2", function(d) {
                        return d.target.x;
                    })
                    .attr("y2", function(d) {
                        return d.target.y;
                    });

                node.attr("cx", function(d) {
                        return d.x;
                    })
                    .attr("cy", function(d) {
                        return d.y;
                    });
            }

            function nodeByName(name) {
                return nodesByName[name] || (nodesByName[name] = {
                    name: name
                });
            }
        });
    </script>